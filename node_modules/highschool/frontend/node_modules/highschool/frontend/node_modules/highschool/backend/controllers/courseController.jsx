import { promisify } from 'util';

// Fetch courses from the database
export const getCourses = async (req, res) => {
    try {
        const sql = `
        SELECT 
            c.id, 
            c.name, 
            i.name AS university, 
            'High School Diploma, Pass in relevant subjects' AS requirements
        FROM courses c
        JOIN institutions i ON c.institution_id = i.id;
        `;
        const data = await query(sql);
        return res.json(data);
    } catch (err) {
        console.error('Error fetching courses:', err);
        return res.status(500).json({ error: "Database error while fetching courses." });
    }
};

// Add a new course
export const addCourse = async (req, res) => {
    const { name, faculty, institution } = req.body;

    if (!name || !faculty || !institution) {
        return res.status(400).json({ error: "Please provide name, faculty, and institution." });
    }

    const sql = "INSERT INTO courses (name, faculty_id, institution_id) VALUES (?, ?, ?)";

    try {
        await query(sql, [name, faculty, institution]);
        return res.status(201).json({ message: "Course added successfully." });
    } catch (err) {
        console.error(err);
        return res.status(500).json({ error: "Database error during adding course." });
    }
};