// Making applications
export const createApplication = async (req, res) => {
    const { 
        student_name, 
        phone_number, 
        student_id, 
        university, 
        course_id, 
        faculty, 
        major_subject, 
        grades 
    } = req.body;

    if (!student_name || !phone_number || !student_id || !university || !course_id || !faculty || !major_subject || !grades) {
        return res.status(400).json({ error: "All fields are required." });
    }

    const subjects = new Array(8).fill('');
    const gradesValues = new Array(8).fill('');
    grades.forEach((grade, index) => {
        subjects[index] = grade.subject || '';
        gradesValues[index] = grade.grade || '';
    });

    const sqlQuery = `
        INSERT INTO applications (
            student_name, 
            phone_number, 
            student_id, 
            university, 
            course_id, 
            faculty, 
            major_subject, 
            subject1, grade1, 
            subject2, grade2, 
            subject3, grade3, 
            subject4, grade4, 
            subject5, grade5, 
            subject6, grade6, 
            subject7, grade7, 
            subject8, grade8
        )
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `;

    const params = [
        student_name, 
        phone_number, 
        student_id, 
        university, 
        course_id, 
        faculty, 
        major_subject,
        ...subjects,
        ...gradesValues
    ];

    try {
        const result = await query(sqlQuery, params);
        res.status(201).json({ message: "Application submitted successfully", id: result.insertId });
    } catch (err) {
        console.error('Error submitting application:', err);
        res.status(500).json({ error: 'Database error during application submission.' });
    }
};